# LLM-MM-Agent: Agent 模块

> Path: `clean version/LLM-MM-Agent/MMAgent/agent/`
> **重要程度**: ⭐⭐⭐ 智能代理核心层

本目录包含 LLM-MM-Agent 系统的所有 Agent 定义和实现。Agent 是系统的智能执行单元，每个 Agent 负责特定类型的任务（问题分析、方法检索、任务求解、图表生成等）。通过 Agent 之间的协作，系统实现了从问题输入到解决方案输出的完整自动化流程。

---

### `__init__.py` ⭐
包初始化文件，将 agent 目录标记为 Python 包，便于模块导入和包管理。

---

### `base_agent.py` ⭐⭐⭐
**所有 Agent 的基类**，定义 Agent 的通用接口和行为模式。提供核心功能包括：统一的 LLM 调用接口（与 llm.py 集成）、提示词管理系统（加载、填充、格式化）、输出解析器（提取结构化结果）、错误处理和重试机制（指数退避）。定义了 Agent 的标准生命周期（初始化→思考→行动→输出）、状态管理（记忆累积、上下文维护）、结果返回格式。所有具体 Agent 都继承自此类，确保系统的一致性和可扩展性。

---

### `coordinator.py` ⭐⭐⭐
**DAG 任务调度器**，管理子任务之间的复杂依赖关系和执行顺序。核心功能包括：构建依赖图（DAG：有向无环图）、拓扑排序确定执行顺序、识别可并行执行的任务、检测循环依赖并报错、处理任务失败和重试。实现了智能的任务编排，确保依赖先完成的任务后执行，无依赖的任务并行执行，最大化执行效率。是系统并行能力和任务协调的核心实现。

---

### `create_charts.py` ⭐⭐⭐
**图表生成管道**，将自然语言图表描述转换为可视化图像的完整流程。实现"描述→代码→图表"的三步转换：第一步，解析图表描述（类型、数据、样式）；第二步，生成对应的 Python 绘图代码（使用 matplotlib/seaborn/plotly）；第三步，执行代码生成图片文件并保存。支持多种图表类型（折线图、柱状图、散点图、热力图、3D 图等），处理样式定制（标题、标签、图例、配色），确保输出符合学术标准。是自动化可视化的核心组件。

---

### `data_description.py` ⭐⭐
**数据描述 Agent**，处理数据集的概览分析和预处理任务。生成数据摘要（样本数、特征数、数据类型）、统计摘要（均值、方差、分位数、缺失率）、分布分析（直方图、箱线图）、相关性分析（相关系数矩阵）。自动识别数据类型（数值、类别、时间、文本）、检测数据质量问题（缺失值、异常值、重复值）、为后续分析提供基础信息。帮助用户快速理解数据集的全貌。

---

### `debug_agent.py` ⭐⭐
**调试 Agent**，诊断管道问题、追踪错误来源、收集调试信息。当系统运行出现异常时，自动分析错误类型和位置、检查日志文件、定位失败的任务、提供可能的修复建议、生成调试报告。是系统故障排除的主要工具，帮助开发者快速定位和解决问题。

---

### `problem_analysis.py` ⭐⭐⭐
**问题分析 Agent**，将复杂建模问题分解为可管理的子任务。输入原始问题描述，输出结构化的子任务列表和依赖关系。采用 actor-critic 模式：Actor 生成初步分解，Critic 评估并反馈，Actor 迭代优化（默认 3 轮）。识别问题类型（优化、预测、分类、评价等）、提取约束条件、明确目标要求、设计求解路径。是 4 阶段管道的起点，决定了后续工作的方向和质量。

---

### `problem_decompose.py` ⭐⭐
**问题分解工具**，提供问题分解的辅助函数和工具方法。支持分治策略（递归分解复杂问题）、依赖分析（识别子任务间的前后关系）、任务优先级排序（按重要性或依赖度排序）、任务粒度控制（避免过粗或过细）。是 problem_analysis Agent 的底层工具集。

---

### `retrieve_method.py` ⭐⭐⭐
**方法检索器**，从 HMML 知识库中检索合适的数学建模方法。基于嵌入相似度匹配计算问题与方法的相似度，支持两种检索模式：1) 问题感知检索（根据问题描述匹配方法特征）；2) 解决方案感知检索（根据已有方案匹配相关方法）。返回 top_method_num（默认 6）个最相关方法及其详细描述（适用场景、数学公式、参数说明、实现要点）。是 HMML 知识库的查询接口，为建模阶段提供专业知识支持。

---

### `task_solving.py` ⭐⭐⭐
**TaskSolver Agent**，编排单个子任务的完整求解流程：分析→建模→编码→执行。管理子任务的四个阶段：问题理解（明确任务目标和输入输出）、数学建模（选择方法、定义变量、构建模型）、代码生成（编写求解代码）、结果验证（检查正确性和合理性）。采用 SafePlaceholder 模式防止模板格式化崩溃（缺失变量时返回占位符而非报错），管理子任务的执行顺序（按 DAG 依赖关系），聚合最终结果。是管道执行的核心协调器，每个子任务都由此 Agent 驱动完成。

---

**文档版本**: v1.0
