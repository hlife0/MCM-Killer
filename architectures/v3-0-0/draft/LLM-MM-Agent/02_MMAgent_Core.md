# LLM-MM-Agent: MMAgent 核心模块

> Path: `clean version/LLM-MM-Agent/MMAgent/`
> **重要程度**: ⭐⭐⭐ 系统核心实现层

本目录是 LLM-MM-Agent 系统的核心实现层，包含主程序入口、核心组件、引擎模块、数据处理管道、知识库、LLM接口、叙述生成、报告系统、提示词管理和代码模板。这些模块协同工作，实现了从问题分析到解决方案报告的完整4阶段管道。理解此目录的代码结构是深入理解系统工作原理的关键。

---

## 主入口

### `main.py` ⭐⭐⭐
**主程序入口**，系统的指挥中心和总控制器。负责命令行参数解析（--key API密钥、--task任务编号、--model_name模型选择等关键参数）、API密钥验证和管理、输出目录自动创建和初始化、4阶段管道的顺序编排和协调、检查点保存与断点恢复逻辑（自动保存管道状态，支持中断后继续执行）。处理所有高层逻辑，包括阶段切换、错误恢复、进度显示、资源清理。是理解系统整体运行流程的最佳起点。

---

## Core 组件 (`core/`)

### `__init__.py` ⭐
包初始化文件，将core目录标记为Python包，便于模块导入。

### `abduction_engine.py` ⭐⭐
**溯因推理引擎**，实现从观察到假设的逆向推理过程。不同于演绎推理（从规则到结论）或归纳推理（从实例到规则），溯因推理从已知结果反推最可能的原因。用于生成可能的解释假设、评估假设的合理性、选择最佳解释。在问题分析阶段帮助理解问题背景和约束条件。

### `red_team_critic.py` ⭐⭐
**红队批评家**，模拟对抗性攻击和负面反馈来测试系统鲁棒性。通过主动寻找系统弱点、生成反例、进行压力测试、挑战假设合理性，从对立角度评估生成内容的质量。这种对抗性测试能够显著提升系统的健壮性和输出质量，避免过度自信和盲区。

### `research_strategist.py` ⭐⭐
**研究策略规划器**，制定整体研究计划和方法选择策略。分析问题的特点和难点、推荐合适的建模方法和工具、规划最优的研究路径和执行顺序、预测潜在风险和备选方案。在问题分析阶段为后续工作提供战略指导，避免盲目尝试和资源浪费。

### `research_strategist_fsm.py` ⭐⭐
**研究策略状态机**，用有限状态机（FSM）实现研究策略的动态调整和转换。定义研究的各个状态（如分析、建模、验证、优化）、状态转换条件和触发器、每个状态的行动和输出。根据当前进展和反馈动态调整研究策略，使系统能够灵活应对变化和异常情况。

### `state_manager.py` ⭐⭐⭐
**状态管理系统**，管理Agent的内部状态、状态转换规则、状态持久化。维护Agent当前所处阶段、已完成的任务、累积的上下文信息等状态数据；定义合法的状态转换规则，防止非法跳转；提供状态保存和加载接口，支持检查点机制。确保状态一致性和可恢复性，是实现自动恢复功能的基础。

---

## Data 处理 (`data/`)

### `__init__.py` ⭐
包初始化文件，将data目录标记为Python包，便于模块导入。

### `data_ingestor.py` ⭐⭐⭐
**数据摄取管道**，负责数据的加载、格式转换、清洗、验证等前期处理工作。支持多种数据格式（CSV, Excel, JSON, TXT, Pickle等）的自动识别和读取；进行数据类型推断和转换；执行基本的数据质量检查（缺失值检测、异常值识别、重复数据剔除）；生成数据概览和统计摘要。是数据进入系统的第一道关口，确保后续分析使用高质量、一致的数据。

---

## Engine 组件 (`engine/`)

### `__init__.py` ⭐
包初始化文件，将engine目录标记为Python包。

### `chart_renderer.py` ⭐⭐⭐
**图表渲染引擎**，将数据描述转换为可视化图表的完整管道。支持matplotlib、seaborn、plotly等多种可视化后端；处理图表样式（颜色、字体、线型）、布局（子图排列、图例位置）、保存格式（PNG, PDF, SVG）；理解自然语言图表描述并转换为相应代码。是实现"描述→图表"自动化的核心组件，确保生成高质量、符合学术标准的可视化内容。

### `diagram_engine.py` ⭐⭐
**图表生成引擎**，创建流程图、架构图、系统图、概念图等技术图表。用于生成模型结构图、算法流程图、系统架构图等需要表示结构和关系的图表。支持多种图形表示方法（框图、UML、网络图），自动布局和美化，提升论文的可读性和专业性。

### `feature_engineer.py` ⭐⭐⭐
**特征工程工具**，提供特征提取、特征选择、特征变换、特征组合等完整特征工程功能。支持数值特征（标准化、归一化、分箱）、类别特征（编码、嵌入）、时间特征（周期分解、滑动窗口）、文本特征（TF-IDF、词嵌入）等多种特征工程技术。是机器学习建模的关键前置步骤，直接影响模型性能。

### `knowledge_retriever.py` ⭐⭐⭐
**知识检索系统**，从HMML等知识库中检索相关的建模方法、案例、公式。基于嵌入相似度匹配和关键词检索，支持问题感知检索（根据问题描述匹配方法）和解决方案感知检索（根据已有方案匹配相关方法）。返回top-K个最相关的知识条目，为建模阶段提供专业的领域知识支持。

### `model_arena.py` ⭐⭐
**模型竞技场**，对比不同模型或方法的性能优劣。进行基准测试（在相同数据集上运行多个模型）、性能评估（准确率、F1、AUC等指标）、优劣分析（各模型的强项和弱项）、推荐最佳模型。帮助选择最适合当前问题的建模方法，避免盲目尝试。

### `robustness_tester.py` ⭐⭐
**鲁棒性测试框架**，测试模型或系统在各种干扰条件下的稳定性。包括噪声测试（添加随机噪声）、边界测试（极端值情况）、敏感性测试（参数扰动）、对抗测试（恶意样本）。通过多角度压力测试，识别模型的脆弱环节，指导模型改进。

### `scientific_renderer.py` ⭐⭐⭐
**科学可视化渲染器**，生成符合学术出版标准的高质量图表。遵循学术规范（如Nature、Science风格），处理高分辨率输出（300+ DPI）、矢量格式（PDF, EPS）、学术配色方案、字体大小标准、图注规范。确保生成的图表可直接用于论文投稿，无需后期手工调整。

### `sensitivity_analyzer.py` ⭐⭐⭐
**敏感度分析引擎**，分析参数变化对模型结果的影响程度。识别关键参数（哪些参数对结果影响最大）、量化敏感性（参数变化X%导致结果变化Y%）、生成敏感度报告（排序、可视化、解释）。对于理解模型行为、指导参数调优、评估模型可靠性具有重要意义。

### `sensitivity_engine.py` ⭐⭐
**敏感度分析实现**，执行具体的敏感度计算算法。提供单因素敏感度分析（OAT：One-at-a-Time）、多因素敏感度分析（ Sobol指数、Morris方法）、局部敏感度（某点附近）、全局敏感度（整个参数空间）。是sensitivity_analyzer的计算后端。

### `validation_suite.py` ⭐⭐⭐
**综合验证套件**，集成多种验证方法确保结果可靠性。包括交叉验证（K-fold、分层）、统计检验（显著性检验、置信区间）、专家验证（人工审核）、一致性验证（多次运行对比）。提供全面的验证报告，是保证解决方案质量的关键组件。

---

## Execution 环境 (`execution/`)

### `__init__.py` ⭐
包初始化文件，将execution目录标记为Python包。

### `kernel_client.py` ⭐⭐⭐
**内核客户端**，代码执行环境的客户端接口。与Jupyter内核或独立Python进程通信，发送代码执行请求、接收执行结果、捕获输出和错误。支持超时控制（防止无限循环）、内存限制（防止内存泄漏）、安全隔离（防止恶意操作）。是系统执行生成代码的关键组件，确保代码在受控环境中运行。

---

## Knowledge 知识库 (`knowledge/`)

### `__init__.py` ⭐
包初始化文件，将knowledge目录标记为Python包。

### `domain_knowledge.json` ⭐⭐
**领域知识库**，存储特定领域的专业知识、经验规则、最佳实践。按领域（如优化、预测、分类、评价、仿真等）组织结构化知识，包含领域特定的约束条件、常用方法、典型陷阱、专家经验。为系统提供领域智能，避免盲目尝试。

### `history_knowledge.json` ⭐⭐
**历史知识库**，存储历史问题和解决方案的成功模式、典型案例、常见错误。通过类比推理，将当前问题与历史案例匹配，借鉴成功经验，避免重复失败。是系统"学习"和积累知识的载体。

### `knowledge_base.py` ⭐⭐
**知识库管理系统**，提供知识的存储、检索、更新、验证功能。统一管理多个知识源（HMML、领域知识、历史知识）；支持知识查询（相似度匹配、关键词检索）；提供知识更新接口（新增、修改、删除）；验证知识一致性。是知识管理和检索的统一入口。

---

## LLM 接口 (`llm/`)

### `__init__.py` ⭐
包初始化文件，将llm目录标记为Python包。

### `llm.py` ⭐⭐⭐
**统一LLM接口**，支持OpenAI（GPT-4, GPT-3.5）、DeepSeek、GLM（智谱）、Qwen（通义千问）等多种大语言模型。提供统一的调用接口（generate、chat、stream）、统一的错误处理和重试机制（指数退避）、线程锁防止API并发限流（429错误）、请求速率限制。是多模型兼容的核心适配层，使系统能够灵活切换不同模型，降低对单一API的依赖。

---

## Narrative 生成 (`narrative/`)

### `__init__.py` ⭐
包初始化文件，将narrative目录标记为Python包。

### `abstract_orchestrator.py` ⭐⭐
**抽象叙述编排器**，组织高层次叙述结构和逻辑流。规划论文或报告的整体框架（引言→方法→结果→讨论→结论）；确保各部分的连贯性和逻辑性；控制叙述节奏和信息密度；生成过渡句和连接词。是生成高质量学术文本的结构基础。

### `academic_tools.py` ⭐⭐⭐
**学术写作工具**，提供学术规范、引用格式、写作风格指南。包含学术词汇库（正式、精确的术语表达）、引用格式规范（APA, MLA, IEEE等）、句式模板（定义假设、陈述方法、报告结果）、写作风格指南（被动语态、第三人称、避免口语化）。确保生成的文本符合学术出版标准。

### `critique_generator.py` ⭐⭐
**批评生成器**，对生成内容进行批判性评估和改进建议。识别问题（逻辑漏洞、表达不清、论证不足）、提出具体改进建议（补充数据、调整结构、修正错误）、评估质量（给出评分和理由）。模拟同行评审过程，提升文本质量。

### `narrative_weaver.py` ⭐⭐
**叙述编织器**，将各部分内容整合成连贯的整体叙述。连接段落和章节（生成过渡句）、统一风格和术语（保持一致性）、调整信息顺序（优化阅读体验）、消除重复和矛盾。确保最终文本流畅自然、逻辑清晰。

---

## Output 输出 (`output/`)

### 目录结构 ⭐⭐⭐
**输出目录管理系统**，采用三层结构组织所有输出文件：

```
output/
└── MM-Agent/
    └── {task}_{timestamp}/
        ├── Report/              # 最终PDF报告（交付物）
        ├── Workspace/           # 工作过程文件（可追溯）
        │   ├── charts/          # 可视化图表（PNG/PDF）
        │   ├── code/            # 生成的Python代码
        │   ├── json/            # 结构化JSON数据
        │   ├── latex/           # LaTeX源文件
        │   └── markdown/        # Markdown报告
        └── Memory/              # 系统记忆和诊断（调试用）
            ├── checkpoints/     # 管道状态检查点
            ├── evaluation/      # 质量评估报告
            ├── logs/            # 执行日志
            └── usage/           # API使用统计
```

- **Report层**：存放最终交付的PDF报告，是用户最终获得的成果
- **Workspace层**：记录完整工作过程，支持结果复现和调试
- **Memory层**：保存系统诊断信息，用于问题排查和性能分析

这种分层结构支持自动恢复（通过checkpoints）、事后分析（通过logs）、质量评估（通过evaluation），是系统可维护性的重要保障。

---

## Prompt 模板 (`prompt/`)

### `__init__.py` ⭐
包初始化文件，将prompt目录标记为Python包。

### `chart_template_prompt.py` ⭐⭐
**图表生成提示词模板**，定义如何向LLM描述图表生成需求。包含图表类型选择（折线图、柱状图、散点图、热力图等）、数据映射说明（X轴、Y轴、颜色、大小）、样式要求（标题、标签、图例、配色）。通过结构化的提示词模板，确保生成的图表描述准确、完整，便于后续代码生成。

### `constants.py` ⭐⭐
**提示词常量和共享变量**，定义常用的提示词片段、变量名、格式规范。包括系统角色设定、输出格式要求、质量标准描述等可复用的文本片段。确保提示词的一致性，避免重复定义，便于全局修改和维护。

### `decompose_prompt.json` ⭐⭐
**问题分解提示词JSON格式**，定义如何将复杂问题分解为可管理的子任务。包含分解规则（如何识别子任务边界）、子任务描述模板（每个子任务应包含哪些信息）、依赖关系说明（子任务间的先后顺序）。是问题分析Agent的核心提示词。

### `journal_prompts.py` ⭐⭐
**研究日志生成提示词**，定义如何生成研究过程的详细日志记录。包含日志结构（时间戳、操作、输入、输出、思考过程）、内容要求（记录关键决策、失败尝试、参数调整）、风格指南（清晰、客观、可复现）。生成的日志有助于事后分析和经验积累。

### `template.py` ⭐⭐⭐
**集中式提示词模板管理系统**，统一管理所有提示词模板。提供模板加载（从文件或数据库）、变量替换（安全地填充占位符）、格式化（确保输出符合预期）、版本管理（模板的迭代和回滚）。是提示词工程的基础设施，确保提示词的质量和一致性。

---

## Prompt 集合 (`prompts/`)

### `abstract_prompts.py` ⭐⭐
**抽象推理提示词**，用于生成抽象层面的分析和推理。引导LLM进行高层概念思考、模式识别、原理归纳。适用于问题理解和策略制定阶段。

### `arena_prompts.py` ⭐⭐
**模型对比竞技场提示词**，用于不同模型或方法之间的对比评估。引导LLM分析优劣、识别最佳实践、提供改进建议。支持模型选择和性能优化。

### `decoupled_prompts.py` ⭐⭐
**解耦阶段提示词**，将复杂任务分解为独立的、可组合的阶段。每个阶段专注于特定目标，降低LLM的认知负担。提升任务完成质量和可维护性。

### `strategist_prompts.py` ⭐⭐
**研究策略提示词**，用于制定研究计划和策略选择。引导LLM分析问题特点、评估方法适用性、规划执行路径、预测潜在风险。是研究策略规划器的核心提示词。

---

## Reporting 系统 (`reporting/`)

### `__init__.py` ⭐
包初始化文件，将reporting目录标记为Python包。

### `latex_compiler.py` ⭐⭐⭐
**LaTeX编译引擎**，将.tex源文件编译为PDF文档。处理编译错误（语法错误、缺失依赖）、依赖管理（自动安装缺失的包）、多次编译（解决交叉引用）。是生成最终论文报告的关键组件，确保LaTeX文档能够成功编译。

### `multi_format_publisher.py` ⭐⭐⭐
**多格式输出发布器**，同时生成JSON、Markdown、LaTeX、PDF等多种格式的报告。确保各种格式的内容一致（数据、图表、结论同步）；提供格式转换（Markdown→LaTeX→PDF）；支持增量更新（只重新生成变化的部分）。满足不同使用场景的需求。

### `report_manifest.py` ⭐⭐
**报告清单和元数据管理**，记录报告的结构、文件清单、版本信息。包括章节结构、图表清单、参考文献、生成时间、Agent签名、校验和等。用于报告管理、版本追踪、完整性验证。是报告可追溯性的基础。

---

## Schema 定义 (`schema/`)

### `chart_schema.py` ⭐⭐
**图表数据模式定义**，规定图表数据的结构和格式。定义数据字段（标题、类型、X轴、Y轴、系列）、类型约束（数值、类别、时间）、验证规则（数据完整性、一致性）。是图表生成的数据契约，确保输入数据符合预期格式。

### `scientific_chart_schema.py` ⭐⭐⭐
**科学图表规范**，定义符合学术出版标准的图表格式。包含尺寸要求（宽度、高度、边距）、分辨率规范（300 DPI以上）、字体标准（Times New Roman、字号）、颜色方案（色盲友好、黑白打印兼容）、图注规范（图序、图题、图例）。确保生成的图表符合学术期刊投稿要求。

---

## Code 模板 (`code_template/`)

### `main.py` ⭐⭐⭐
**解决方案基础代码模板**，提供标准的问题求解代码框架。包含导入部分（numpy, pandas, matplotlib等）、数据加载函数、模型定义区、结果输出区、图表生成区。是所有生成代码的起点，确保代码结构统一、规范、易于维护。

### `main1.py` ~ `main10.py` ⭐⭐
**编号的模板文件**，提供不同的解决方案方法或代码模式。每个模板对应一类常见的建模方法（如线性规划、回归分析、分类算法、聚类方法）。支持多种建模方法的基本框架，为LLM生成代码提供参考范本，提升生成质量。

---

**文档版本**: v1.0
