# Report 机制设计

> **核心前提**：Report 是 Agent 向 Director 的单向汇报，每次调用完成后强制执行。

---

## 一、Report 的本质

**Report = Agent 向 Director 的工作汇报**

特点：
1. **单向**：Agent → Director，不期待回复
2. **强制**：每次 Agent 调用完成后必须汇报
3. **私密**：仅 Director 可见，其他 Agent 不可见
4. **追踪调用历史**：记录每个 Agent 被调用了多少次，每次做了什么

---

## 二、Report 的目的

1. **进度追踪**：Director 知道每个 Agent 完成了什么
2. **问题发现**：Agent 主动上报遇到的问题
3. **决策支持**：Agent 提供下一步建议
4. **审计记录**：事后可以回顾整个工作流程

---

## 三、汇报时机

| 时机 | 是否必须 | 说明 |
|------|---------|------|
| Agent 调用完成（正常） | ✅ 必须 | 无论成功失败都要汇报 |
| Agent 调用完成（失败） | ✅ 必须 | 汇报失败原因 |
| Agent 调用中途遇到阻塞 | ✅ 必须 | 先汇报问题，再发起 Consultation |

---

## 四、汇报内容

### 4.1 必须包含

| 字段 | 说明 |
|------|------|
| Agent 名称 | 谁在汇报 |
| 调用序号 | 第几次被调用 |
| 开始时间 | 调用开始的时间戳 |
| 结束时间 | 调用结束的时间戳 |
| 耗时 | 本次调用花了多长时间 |
| 状态 | SUCCESS / FAILED / PARTIAL |
| 任务摘要 | 一句话描述做了什么 |

### 4.2 可选包含

| 字段 | 说明 |
|------|------|
| 执行内容详情 | 具体做了哪些步骤 |
| 产出物列表 | 创建/修改了哪些文件 |
| 问题与风险 | 遇到的问题、不确定性 |
| 下一步建议 | 建议 Director 接下来做什么 |

---

## 五、汇报格式

```markdown
# Agent 汇报: {agent_name} #{i}

## 基本信息

| 字段 | 值 |
|------|------|
| Agent | {agent_name} |
| 调用序号 | {i} |
| 开始时间 | {YYYY-MM-DD HH:MM:SS} |
| 结束时间 | {YYYY-MM-DD HH:MM:SS} |
| 耗时 | {HH:MM:SS 或 X 分钟} |
| 状态 | ✅ SUCCESS / ❌ FAILED / ⚠️ PARTIAL |

---

## 任务摘要

{一句话描述本次调用的主要任务}

---

## 执行内容

1. {做了什么}
2. {做了什么}
3. ...

---

## 产出物

| 文件 | 路径 | 说明 |
|------|------|------|
| {name} | {path} | {description} |

---

## 问题与风险

{遇到的问题、不确定性、需要 Director 注意的事项}

（如无问题，写"无"）

---

## 下一步建议

{建议 Director 接下来调用哪个 Agent，或需要什么决策}
```

---

## 六、状态说明

| 状态 | 含义 | 典型场景 |
|------|------|---------|
| ✅ **SUCCESS** | 任务完成，产出符合预期 | 正常情况 |
| ❌ **FAILED** | 任务失败，无法完成 | 文件不存在、工具错误、无法解决的问题 |
| ⚠️ **PARTIAL** | 部分完成，有遗留问题 | 主要任务完成，但有小问题待处理 |

---

## 七、目录结构

```
docs/
└── report/
    ├── reader_1.md
    ├── reader_2.md         # reader 被调用了 2 次
    ├── researcher_1.md
    ├── modeler_1.md
    ├── modeler_2.md        # modeler 被调用了 2 次
    ├── data_engineer_1.md
    └── ...
```

命名格式：`{agent_name}_{i}.md`，`{i}` 为该 Agent 的第几次调用。

---

## 八、与其他机制的关系

### 8.1 Report vs Consultation

| 方面 | Report | Consultation |
|------|--------|--------------|
| 方向 | Agent → Director | Agent ↔ Agent（通过 Director） |
| 目的 | 汇报进度 | 寻求信息 |
| 期待回复 | 否 | 是 |
| 时机 | 任务完成后 | 任务中遇到问题 |

### 8.2 Report vs Validation

| 方面 | Report | Validation |
|------|--------|------------|
| 执行者 | 每个 Agent 自己 | Validator Agent |
| 内容 | 自己做了什么 | 检查别人做的对不对 |
| 时机 | 每次调用后 | 特定 Gate 位置 |

---

## 九、问题上报

Agent 在汇报中可以上报问题，触发 Director 决策：

### 9.1 问题类型

| 类型 | 格式 | Director 动作 |
|------|------|--------------|
| 阻塞性问题 | "遇到阻塞：{description}" | 必须解决才能继续 |
| 建议性问题 | "建议：{description}" | 可以忽略或处理 |
| 风险提示 | "风险：{description}" | 记录，后续关注 |

### 9.2 示例

```markdown
## 问题与风险

**阻塞性问题**：
- 数据文件 raw/train.csv 不存在，无法继续数据处理

**建议**：
- 特征 X 的缺失值较多（30%），建议与 modeler 讨论是否需要

**风险**：
- 训练数据量较小（仅 500 条），模型可能过拟合
```

---

## 十、总结

**Report 的核心特点**：
1. **单向**：Agent → Director
2. **强制**：每次调用后必须汇报
3. **私密**：仅 Director 可见
4. **结构化**：固定格式，便于追踪
5. **可包含问题上报**：阻塞/建议/风险
