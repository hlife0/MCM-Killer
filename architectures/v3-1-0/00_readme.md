# MCM-Killer Architecture v3.1.0

> **Version**: v3.1.0 (Cognitive Narrative & Adversarial Evolution)
> **Date**: 2026-01-25
> **Purpose**: Complete detailed architecture with cognitive narrative and adversarial validation
> **Status**: Complete (Consolidated)

---

## Version Summary

**v3.1.0** is a major evolutionary release that:

1. **Adds Cognitive Narrative Layer**: Transform "errors and struggles" into "research insights" via Iterative Refinement
2. **Adds Adversarial Quality System**: Red-blue team confrontation for rigorous review
3. **Adds Dynamic Knowledge Base**: HMML 2.0 with protocol-invoked consultation
4. **Adds Academic Style Alignment**: Learning from O-Prize reference papers
5. **Adds Self-Evolution Mechanism**: Continuous improvement through benchmarking
6. **Maintains Backward Compatibility**: All v3.0.0 protocols, agents, and phases preserved

---

## What's New in v3.1.0

### Quantitative Changes

| Dimension | v3.0.0 | v3.1.0 | Change |
|-----------|--------|--------|--------|
| **Agents** | 14 | 18 | +4 new (+28%) |
| **Phases** | 10 | 13 | +3 new (+30%) |
| **Protocols** | 12 | 15 | +3 new (+25%) |
| **Knowledge Base** | Static HMML | Dynamic HMML 2.0 | Restructured |
| **Output Quality** | Correct but flat | Insightful & deep | Narrative upgrade |
| **Validation** | Internal only | Adversarial red-blue | Quality leap |

### New Components

#### 4 New Agents
1. **@metacognition_agent** - Extract insights from training struggles
2. **@narrative_weaver** - Outline Coordinator (Non-dramatic organization)
3. **@knowledge_librarian** - Academic Consultant (Protocol-invoked)
4. **@judge_zero** - Red team adversarial reviewer

#### 5 New Phases
- **Pre-Competition**: Style Guide Generation
- **Phase 0.2**: Protocol-Invoked Consultation (On-demand methods)
- **Phase 5.8**: Insight Extraction (metacognitive analysis)
- **Phase 9.1**: Mock Judging (adversarial review)
- **Phase 11**: Self-Evolution (post-competition benchmarking)

#### 3 New Protocols
- **Protocol 13**: Mock Court Rewind (DEFCON 1 state machine)
- **Protocol 14**: Academic Style Alignment (mandatory style_guide.md loading)
- **Protocol 15**: Interpretation over Description (Observation-Implication enforcement)

---

## Document Structure (Consolidated)

```
v3-1-0/
├── README.md                           # This file - Version overview
│
├── ARCHITECTURE_COMPLETE.md            # Complete system architecture (Parts 1-3)
├── ARCHITECTURE_PART2_PHASES.md        # All 13 phases with detailed templates
├── ARCHITECTURE_PART3_NARRATIVE.md     # Narrative framework, workspace, Python tools
├── PROTOCOLS_COMPLETE.md               # All 15 protocols consolidated
│
├── 01_version_comparison.md            # v3.0.0 vs v3.1.0 detailed comparison
├── knowledge_library_specification.md  # HMML 2.0 complete specification
├── implementation_guide.md             # 3-sprint implementation roadmap
├── testing_guide.md                    # Testing strategy
│
├── agents/                             # Agent prompt files
│   ├── metacognition_agent.md
│   ├── narrative_weaver.md             # Updated: Conciseness mandate
│   ├── knowledge_librarian.md
│   ├── judge_zero.md                   # Updated: O Award training protocol
│   ├── code_translator_enhancement.md
│   ├── visualizer_enhancement.md
│   └── writer_enhancement.md           # NEW: LaTeX quality standards
│
├── templates/                          # Template files
│   ├── ANTI_PATTERNS.md
│   ├── narrative_arcs/
│   │   ├── hero_journey.md
│   │   ├── onion_peeling.md
│   │   ├── comparative_evolution.md
│   │   └── observation_implication.md
│   ├── writing/
│   │   ├── abstract_template.md
│   │   ├── dev_diary_entry.md
│   │   ├── judgment_report_template.md
│   │   ├── latex_formatting_standards.md # NEW: O Award LaTeX standards
│   │   └── paper_outline_template.md
│   └── knowledge_base/
│       ├── method_file_template.md
│       └── suggested_methods_template.md
│
├── tools/                              # Python tools
│   ├── style_analyzer.py
│   ├── log_analyzer.py
│   ├── mmbench_score.py
│   ├── init_workspace.py
│   ├── migrate_hmml.py
│   ├── system_prompts.py               # NEW: P0 functional component - modular prompts
│   ├── safe_template.py                # NEW: P0 functional component - crash-proof templates
│   └── journal_prompts.py              # NEW: P1 functional component - metacognition prompts
│
└── (Supporting docs)
    ├── STRUCTURE.md                    # Navigation guide
    ├── CONSOLIDATION_STATUS.md         # Consolidation tracking
    ├── CONSOLIDATION_PLAN.md           # Consolidation strategy
    ├── COMPLETION_SUMMARY.md           # Historical record
    └── MASTER_INDEX.md                 # Legacy index (needs update)
```

---

## Reading Guide

### For Complete Understanding

**Step 1: Architecture Overview**
1. `ARCHITECTURE_COMPLETE.md` - System overview, 18-Agent Grid, phase workflow overview

**Step 2: Phase Details**
2. `ARCHITECTURE_PART2_PHASES.md` - All 13 phases with complete templates

**Step 3: Narrative & Tools**
3. `ARCHITECTURE_PART3_NARRATIVE.md` - Cognitive narrative framework, workspace structure, Python tools

**Step 4: Protocols**
4. `PROTOCOLS_COMPLETE.md` - All 15 protocols (v3.0.0 + v3.1.0)

**Step 5: Specifications**
5. `knowledge_library_specification.md` - HMML 2.0 specification
6. `01_version_comparison.md` - Detailed v3.0.0 vs v3.1.0 comparison

**Step 6: Implementation**
7. `implementation_guide.md` - 3-sprint implementation roadmap
8. `testing_guide.md` - Testing strategy

### Quick Reference

| Topic | Document |
|-------|----------|
| **System Overview** | `ARCHITECTURE_COMPLETE.md` |
| **Phase Details** | `ARCHITECTURE_PART2_PHASES.md` |
| **Protocols** | `PROTOCOLS_COMPLETE.md` |
| **Narrative Framework** | `ARCHITECTURE_PART3_NARRATIVE.md` |
| **HMML 2.0** | `knowledge_library_specification.md` |
| **Version Comparison** | `01_version_comparison.md` |

---

## 15 Protocols Overview

### v3.0.0 Protocols (1-12) - Preserved

1. **@director File Reading Ban** - Prevent evaluation contamination
2. **@time_validator Strict Mode** - Reject lazy implementations
3. **Enhanced Time Estimation** - Improve prediction accuracy
4. **Phase 5 Parallel Workflow** - Save 6-12 hours
5. **@code_translator Idealistic Mode** - Enforce perfect implementation
6. **48-Hour Escalation Protocol** - Decision framework
7. **@director/@time_validator Handoff** - Standardized communication
8. **Model Design Expectations** - Systematic validation
9. **@validator/@advisor Brief Format** - Fast decision-making
10. **Phase 5B Error Monitoring** - Prevent lost errors
11. **Emergency Convergence Delegation** - 8x faster response
12. **Phase 4.5 Re-Validation** - 8x fraud reduction

### v3.1.0 New Protocols (13-15)

13. **Mock Court Rewind** (Protocol 13) - DEFCON 1 adversarial review
14. **Academic Style Alignment** (Protocol 14) - Mandatory style_guide.md loading
15. **Interpretation over Description** (Protocol 15) - Observation-Implication enforcement

**Details**: See `PROTOCOLS_COMPLETE.md`

---

## 18 Agents Overview

### v3.0.0 Agents (14 - Preserved)

| Agent | Role | v3.1.0 Status |
|-------|------|---------------|
| @reader | PDF reader | Unchanged |
| @researcher | Method suggestor | Enhanced (Phase 0.2) |
| @modeler | Math architect | Unchanged |
| @feasibility_checker | Tech assessor | Unchanged |
| @data_engineer | Data expert | Unchanged |
| @code_translator | Math-to-code | Enhanced (dev_diary.md) |
| @model_trainer | Training executor | Unchanged |
| @validator | Quality checker | Unchanged |
| @visualizer | Visual designer | Enhanced (Mode B) |
| @writer | Paper author | Enhanced (style constraint) |
| @summarizer | Summary expert | Unchanged |
| @editor | Polisher | Enhanced (style constraint) |
| @advisor | Quality advisor | Unchanged |
| @time_validator | Anti-fraud guardian | Unchanged |
| @director | Team coordinator | Unchanged |

### v3.1.0 New Agents (4)

| Agent | Role | Integration Point |
|-------|------|-------------------|
| **@metacognition_agent** | Philosopher & Forensic Analyst | Phase 5.8 |
| **@narrative_weaver** | Outline Coordinator | Phase 7 |
| **@knowledge_librarian** | Academic Consultant | Phase -1, 0.2 |
| **@judge_zero** | Red Team Critic & Gatekeeper | Phase 9.1 |

**Details**: See `ARCHITECTURE_COMPLETE.md` and `agents/` directory

---

## 13 Phases Overview

### Complete Phase Sequence

```
-1 -> 0 -> 0.2 -> 0.5 -> 1 -> 1.5 -> 2 -> 3 -> 4 -> 4.5 -> 5A -> 5B -> 5.5 -> 5.8 -> 6 -> 6.5 -> 7 -> 7.5 -> 8 -> 9 -> 9.1 -> 9.5 -> 10 -> 11
```

### New Phases in v3.1.0

- **Pre-Competition**: Style Guide Generation - Learn from O-Prize papers
- **Phase 0.2**: Protocol-Invoked Consultation - On-demand advanced methods
- **Phase 5.8**: Insight Extraction - Metacognitive analysis
- **Phase 9.1**: Mock Judging - Adversarial review
- **Phase 11**: Self-Evolution - Post-competition benchmarking

**Details**: See `ARCHITECTURE_PART2_PHASES.md`

---

## Migration from v3.0.0

### Compatibility Guarantee

**100% Backward Compatible**

- All 14 v3.0.0 agents: Preserved (some enhanced, none removed)
- All 10 v3.0.0 phases: Preserved (5 inserted, none removed)
- All 12 v3.0.0 protocols: Preserved (3 added, none removed)

### How to Migrate

**Option A: Full Migration**
- Follow `implementation_guide.md` (3-sprint approach)
- End state: Full v3.1.0 system operational

**Option B: Incremental Adoption**
1. Adopt HMML 2.0 only
2. Add @metacognition_agent
3. Add @judge_zero
4. Enable all features

**Option C: Continue v3.0.0**
- All existing functionality preserved
- No action required

---

## Key Innovations

### 1. Cognitive Narrative Framework
- **Iterative Refinement Template**: Transform struggles into research insights
- **Observation-Implication Protocol**: Every data point paired with meaning
- **Metacognitive Agent**: Extracts insights from training logs

### 2. Adversarial Quality System
- **@judge_zero**: Three-persona review (Statistician + Domain Expert + Exhausted Editor)
- **DEFCON 1**: Emergency repair mode when paper rejected
- **Mercy Rule**: Prevent infinite loops while maintaining quality

### 3. Dynamic Knowledge Base (HMML 2.0)
- **Structured Methods**: Domain -> Subdomain -> Method hierarchy
- **Metadata Enrichment**: narrative_value, common_pitfalls, O-Prize examples
- **Protocol-Invoked Consultation**: @knowledge_librarian consults on request

### 4. Academic Style Alignment
- **Pre-Competition**: Automatically learn from O-Prize papers
- **style_guide.md**: Generated rules for academic writing
- **Protocol 14**: Mandatory style compliance for all text agents

### 5. Self-Evolution Mechanism
- **Phase 11**: Post-competition automated scoring
- **mmbench_score.py**: Rule-based paper evaluation
- **Trend Analysis**: Track improvement across competitions

---

## Python Tools

Located in `tools/` directory:

| Tool | Purpose | Usage |
|------|---------|-------|
| `style_analyzer.py` | Analyze O-Prize PDFs to generate style_guide.md | Pre-Competition |
| `log_analyzer.py` | Compress training logs to JSON summaries | Phase 5.8 |
| `mmbench_score.py` | Automated rule-based scoring (0-100) | Phase 11 |
| `init_workspace.py` | Create v3.1.0 directory structure | Setup |
| `migrate_hmml.py` | Convert flat HMML.md to HMML 2.0 structure | Migration |

### Functional Components (Integrated from MM-Agent)

| Component | Priority | Purpose | Source |
|-----------|----------|---------|--------|
| `system_prompts.py` | **P0** | Modular prompts (~87% token savings) | MM-Agent template.py |
| `safe_template.py` | **P0** | Crash-proof template formatting | MM-Agent task_solving.py |
| `journal_prompts.py` | **P1** | Metacognitive reflection prompts | MM-Agent journal_prompts.py |

**P0 Components (Must-Have)**:

1. **`system_prompts.py`** - Contains:
   - `BASE_SYSTEM_PROMPT`: Prevents agent work duplication
   - `CODING_SYSTEM_PROMPT`: Enforces 6-line imports, UTF-8, path handling
   - `ONE_SHOT_CODING_EXAMPLE`: Teaching by example for coding tasks
   - `MCM_KILLER_AGENT_PREAMBLE`: Multi-agent coordination rules
   - `NARRATIVE_SYSTEM_PROMPT`: For Storyteller cluster agents
   - `CRITIC_SYSTEM_PROMPT`: For Critics cluster agents

2. **`safe_template.py`** - Contains:
   - `SafePlaceholder`: Smart placeholder that prevents AttributeError crashes
   - `_SafeDict`: Dictionary that returns placeholders for missing keys
   - `safe_format()`: Drop-in replacement for str.format() that never crashes
   - `format_agent_prompt()`: MCM-Killer specific prompt formatting

**P1 Components (Strongly Recommended)**:

3. **`journal_prompts.py`** - Contains:
   - `JOURNAL_SYSTEM_PROMPT`: Research journal mode system prompt
   - `STAGE_REFLECTION_ANALYSIS`: Problem analysis reflection
   - `STAGE_REFLECTION_MODELING`: Modeling process reflection
   - `ERROR_DIAGNOSIS`: DEFCON 1 autopsy report generation
   - `NARRATIVE_ARC_EXTRACTION`: Hero's Journey extraction for @metacognition_agent

---

## Version History

| Version | Date | Type | Key Changes |
|---------|------|------|-------------|
| v3.0.0 | 2026-01-24 | Complete | Two-system architecture |
| **v3.1.0** | **2026-01-25** | **Evolutionary** | **Cognitive narrative + adversarial validation** |
| v3.1.0-consolidated | 2026-01-25 | Consolidation | 27 files merged to 12 core docs |
| **v3.1.0-O-trained** | **2026-01-25** | **O Award Integration** | **All 18 agents trained on O Award criteria** |

---

**Document Version**: v3.1.0 (Consolidated)
**Last Updated**: 2026-01-25
**Status**: Complete

**Next**: Read `ARCHITECTURE_COMPLETE.md` for system overview
