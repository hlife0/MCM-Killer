# HMML 2.0: Hierarchical Mathematical Methods Library Specification

> **Version**: 2.0 (Structured)
> **Architecture**: v3.1.0
> **Purpose**: Organized knowledge base for O-Prize level methods
> **Migration**: From flat HMML.md to hierarchical structure

---

## Overview

HMML 2.0 transforms the flat knowledge base into a **structured, searchable, narrative-rich** method library.

### Key Improvements

| Feature | HMML 1.0 | HMML 2.0 |
|---------|----------|----------|
| **Structure** | Flat file | Hierarchical directory |
| **Metadata** | None | YAML front matter |
| **Searchability** | Manual | Domain/keyword indexed |
| **Narrative Value** | Implicit | Explicit field |
| **O-Prize Examples** | Scattered | Structured references |
| **Complexity** | Unspecified | Categorized (Very High/High/Medium/Low) |

---

## Directory Structure

```
knowledge_library/
├── index.md                         # Master catalog
├── hmml_summary.json                # Machine-readable index
├── methods/
│   ├── optimization/
│   │   ├── linear_programming/
│   │   │   ├── simplex.md
│   │   │   ├── interior_point.md
│   │   │   └── dual_simplex.md
│   │   ├── nonlinear_optimization/
│   │   │   ├── gradient_descent.md
│   │   │   ├── newton_method.md
│   │   │   └── conjugate_gradient.md
│   │   ├── heuristics/
│   │   │   ├── genetic_algorithm.md
│   │   │   ├── simulated_annealing.md
│   │   │   ├── particle_swarm.md
│   │   │   └── ant_colony.md
│   │   └── multi_objective/
│   │       ├── pareto_optimization.md
│   │       └── weighted_sum.md
│   ├── differential_equations/
│   │   ├── epidemic/
│   │   │   ├── sir_basic.md
│   │   │   ├── sir_network.md
│   │   │   ├── seir.md
│   │   │   └── agent_based.md
│   │   ├── sde/
│   │   │   ├── euler_maruyama.md
│   │   │   ├── milstein.md
│   │   │   └── geometric_brownian.md
│   │   ├── pde/
│   │   │   ├── finite_difference.md
│   │   │   ├── finite_element.md
│   │   │   └── spectral_methods.md
│   │   └── systems/
│   │       ├── lotka_volterra.md
│   │       └── lorenz_attractor.md
│   ├── statistics/
│   │   ├── bayesian/
│   │   │   ├── hierarchical.md
│   │   │   ├── mcmc.md
│   │   │   ├── nuts_sampler.md
│   │   │   └── variational_bayes.md
│   │   ├── frequentist/
│   │   │   ├── hypothesis_testing.md
│   │   │   ├── regression.md
│   │   │   └── bootstrap.md
│   │   └── time_series/
│   │       ├── arima.md
│   │       ├── var.md
│   │       ├── state_space.md
│   │       └── kalman_filter.md
│   ├── network_science/
│   │   ├── centrality/
│   │   │   ├── degree.md
│   │   │   ├── betweenness.md
│   │   │   ├── eigenvector.md
│   │   │   └── pagerank.md
│   │   ├── community/
│   │   │   ├── modularity.md
│   │   │   ├── louvain.md
│   │   │   └── spectral_clustering.md
│   │   └── dynamics/
│   │       ├── epidemic_on_network.md
│   │       ├── diffusion.md
│   │       └── cascade.md
│   ├── machine_learning/
│   │   ├── supervised/
│   │   │   ├── random_forest.md
│   │   │   ├── xgboost.md
│   │   │   ├── neural_network.md
│   │   │   └── svm.md
│   │   ├── unsupervised/
│   │   │   ├── kmeans.md
│   │   │   ├── dbscan.md
│   │   │   ├── pca.md
│   │   │   └── autoencoder.md
│   │   └── abm/
│   │       ├── simple_abm.md
│   │       ├── mesa_framework.md
│   │       └── netlogo_integration.md
│   └── simulation/
│       ├── monte_carlo/
│       │   ├── basic_mc.md
│       │   ├── importance_sampling.md
│       │   └── metropolis_hastings.md
│       └── discrete_event/
│           ├── queue_simulation.md
│           └── process_simulation.md
├── academic_writing/
│   ├── style_guide.md              # Generated by style_analyzer.py
│   ├── o_prize_patterns.md         # Extracted from winners
│   └── narrative_templates.md      # From m-orientation
└── anti_patterns/
    └── ANTI_PATTERNS.md            # Kill List

```

---

## Method File Format

Each method file follows this template (see `templates/knowledge_base/method_file_template.md`):

### YAML Front Matter (Required)

```yaml
---
name: "Method Name"
domain: "primary_domain"
category: "subcategory"
complexity: "Very High | High | Medium | Low"
implementation_time: "X-Y hours"
narrative_value: "Very High | High | Medium | Low"
o_prize_examples:
  - year: YYYY
    problem: "Letter"
    usage: "Brief description"
keywords:
  - "keyword1"
  - "keyword2"
prerequisites:
  - "prerequisite1"
common_pitfalls:
  - "pitfall1"
last_updated: "YYYY-MM-DD"
---
```

### Body Sections (Required)

1. **Overview**: 2-3 sentence description
2. **Mathematical Foundation**: Core equations, variables, assumptions
3. **When to Use**: Good fit scenarios, poor fit scenarios
4. **Implementation Guide**: Step-by-step with code
5. **Narrative Value**: Why it wins O-Prize, key phrases, templates
6. **Common Pitfalls**: Mistakes and fixes
7. **O-Prize Examples**: Specific past winners
8. **Related Methods**: Links to other methods
9. **References**: Academic citations

---

## Domain Taxonomy

### Primary Domains

| Domain | Subdirectories | Typical Complexity |
|--------|---------------|-------------------|
| **optimization** | linear, nonlinear, heuristics, multi_objective | Medium-High |
| **differential_equations** | epidemic, sde, pde, systems | High-Very High |
| **statistics** | bayesian, frequentist, time_series | Medium-High |
| **network_science** | centrality, community, dynamics | High-Very High |
| **machine_learning** | supervised, unsupervised, abm | High |
| **simulation** | monte_carlo, discrete_event | Medium |

### Keyword Mapping

Used by @knowledge_librarian for domain classification:

```python
DOMAIN_KEYWORDS = {
    'optimization': [
        'minimize', 'maximize', 'constraint', 'objective',
        'route', 'allocation', 'scheduling', 'resource'
    ],
    'differential_equations': [
        'epidemic', 'disease', 'infection', 'spread',
        'dynamics', 'system', 'ode', 'pde'
    ],
    'statistics': [
        'predict', 'forecast', 'regression', 'uncertainty',
        'confidence', 'hypothesis', 'test'
    ],
    'network_science': [
        'network', 'graph', 'topology', 'connection',
        'centrality', 'community', 'hub'
    ],
    'machine_learning': [
        'classify', 'predict', 'learn', 'train',
        'neural', 'forest', 'clustering'
    ],
    'simulation': [
        'simulate', 'monte carlo', 'random',
        'stochastic', 'agent-based'
    ]
}
```

---

## index.md Format

The master catalog provides human-readable overview:

```markdown
# HMML 2.0 Master Catalog

> **Last Updated**: YYYY-MM-DD
> **Total Methods**: N
> **Domains**: 6

---

## Quick Navigation

- [Optimization](#optimization)
- [Differential Equations](#differential-equations)
- [Statistics](#statistics)
- [Network Science](#network-science)
- [Machine Learning](#machine-learning)
- [Simulation](#simulation)

---

## Optimization

### Linear Programming
- [Simplex Method](methods/optimization/linear_programming/simplex.md) - *Medium*
- [Interior Point](methods/optimization/linear_programming/interior_point.md) - *Medium*

### Heuristics
- [Genetic Algorithm](methods/optimization/heuristics/genetic_algorithm.md) - *High*
- [Simulated Annealing](methods/optimization/heuristics/simulated_annealing.md) - *Medium*

---

## Differential Equations

### Epidemic Models
- [SIR-Network](methods/differential_equations/epidemic/sir_network.md) - *High* ⭐⭐⭐⭐⭐
- [SEIR](methods/differential_equations/epidemic/seir.md) - *Medium*

[...]
```

---

## hmml_summary.json Format

Machine-readable index for automated retrieval:

```json
{
  "version": "2.0",
  "last_updated": "YYYY-MM-DD",
  "total_methods": 87,
  "domains": {
    "optimization": {
      "count": 15,
      "categories": ["linear_programming", "nonlinear", "heuristics", "multi_objective"]
    },
    "differential_equations": {
      "count": 18,
      "categories": ["epidemic", "sde", "pde", "systems"]
    }
  },
  "methods": [
    {
      "name": "SIR-Network Model",
      "path": "methods/differential_equations/epidemic/sir_network.md",
      "domain": "differential_equations",
      "category": "epidemic",
      "complexity": "High",
      "narrative_value": "Very High",
      "keywords": ["epidemic", "network", "sir", "transmission"],
      "o_prize_count": 2
    }
  ],
  "narrative_value_high": [
    "methods/differential_equations/epidemic/sir_network.md",
    "methods/statistics/bayesian/hierarchical.md",
    "methods/machine_learning/abm/simple_abm.md"
  ]
}
```

---

## Migration Process

### From HMML 1.0 to HMML 2.0

Use `tools/migrate_hmml.py`:

```bash
python tools/migrate_hmml.py \
    --input knowledge_library/HMML.md \
    --output knowledge_library/methods/ \
    --generate-index
```

**What the tool does**:
1. Parses flat HMML.md
2. Classifies methods by domain (keyword matching)
3. Estimates complexity (line count, equation density)
4. Generates YAML front matter
5. Creates directory structure
6. Generates index.md and hmml_summary.json

**Manual Curation After Migration**:
- Review domain classifications
- Add O-Prize examples
- Fill in narrative value fields
- Add implementation code examples

---

## Usage by Agents

### @knowledge_librarian (Phase 0.2)

```python
# Load HMML 2.0
with open('knowledge_library/hmml_summary.json') as f:
    hmml = json.load(f)

# Classify problem domain
domain = classify_domain(problem_text)

# Get high narrative value methods
candidates = [m for m in hmml['methods']
              if m['domain'] == domain
              and m['narrative_value'] in ['Very High', 'High']]

# Rank by complexity vs time available
recommended = rank_by_feasibility(candidates, time_remaining)
```

### @researcher (Phase 2)

```python
# Search by keywords
results = search_hmml(keywords=['bayesian', 'hierarchical', 'epidemic'])

# Read method details
for method_path in results:
    method_file = read_method(method_path)
    # Extract: math, code, pitfalls, O-Prize examples
```

### @modeler (Phase 3)

```python
# Get implementation guide
method = load_method('methods/differential_equations/epidemic/sir_network.md')
code_example = method['sections']['Implementation Guide']
pitfalls = method['sections']['Common Pitfalls']
```

---

## Quality Standards

### Minimum Requirements for Each Method File

- [ ] YAML front matter complete
- [ ] Mathematical foundation included
- [ ] At least one code example
- [ ] Common pitfalls section (≥2 pitfalls)
- [ ] Narrative value explanation
- [ ] At least one O-Prize example (if applicable)
- [ ] Related methods links (≥1)

### Narrative Value Rating Criteria

| Rating | Criteria |
|--------|----------|
| **Very High** | ≥2 O-Prize examples, cutting-edge method, high judge appeal |
| **High** | 1 O-Prize example or advanced method, strong narrative |
| **Medium** | Standard method, some narrative value |
| **Low** | Baseline method, primarily for comparison |

---

## Maintenance

### Adding New Methods

1. Create method file from template
2. Fill YAML front matter
3. Write all required sections
4. Add to appropriate domain/category directory
5. Run `python tools/migrate_hmml.py --update-index` to regenerate index

### Updating Existing Methods

1. Modify method file
2. Update `last_updated` field in YAML
3. Run index regeneration

### Annual O-Prize Update

After each MCM competition:
1. Analyze winning papers
2. Identify methods used
3. Add to `o_prize_examples` in relevant methods
4. Update `narrative_value` ratings if needed

---

## Integration Points

### Pre-Competition: Style Generation
- `academic_writing/style_guide.md` generated by `tools/style_analyzer.py`

### Phase 0.2: Active Retrieval
- @knowledge_librarian uses `hmml_summary.json` for method search
- Outputs `suggested_methods.md` with references to HMML 2.0 paths

### Phase 2-3: Research & Modeling
- @researcher reads method files for implementation details
- @modeler uses code examples and pitfall warnings

### Phase 5.8: Insight Extraction
- @metacognition_agent references method files for theoretical context
- Uses "Common Pitfalls" to interpret struggles

### Phase 7: Paper Writing
- @narrative_weaver uses "Narrative Value" sections
- @writer copies "Key Phrases" for paper language

---

## Version History

- **v1.0**: Flat HMML.md file
- **v2.0** (2026-01-25): Hierarchical structure, YAML metadata, narrative value
