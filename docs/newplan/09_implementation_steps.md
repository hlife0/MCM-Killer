# Step-by-Step Implementation Guide

> **Version**: 3.2.0
> **Purpose**: Executable implementation steps for the external resources pipeline

---

## Implementation Overview

| Step | Description | Duration | Dependencies |
|------|-------------|----------|--------------|
| 1 | Create folder structure | 5 min | None |
| 2 | Create configuration files | 10 min | Step 1 |
| 3 | Create agent files | 30 min | Step 1 |
| 4 | Create tool scripts | 20 min | Step 1 |
| 5 | Create Protocol 21 | 10 min | Step 3 |
| 6 | Update existing agents | 15 min | Step 5 |
| 7 | Update CLAUDE.md | 15 min | Step 3-6 |
| 8 | Update protocol index | 5 min | Step 5 |
| 9 | Update .gitignore | 2 min | Step 1 |
| 10 | Test pipeline | 20 min | Step 1-9 |
| 11 | Verify integration | 10 min | Step 10 |

**Total Estimated Time**: ~2.5 hours

---

## Step 1: Create Folder Structure

### 1.1 Create main directories

```bash
BASE="D:/mcmkiller/MCM-Killer/workspace/2025_C/output/external_resources"

mkdir -p "$BASE/inbox"
mkdir -p "$BASE/staging"
mkdir -p "$BASE/active"
mkdir -p "$BASE/rejected"
mkdir -p "$BASE/archived"
```

### 1.2 Create index directories

```bash
mkdir -p "$BASE/by_domain/epidemiology"
mkdir -p "$BASE/by_domain/optimization"
mkdir -p "$BASE/by_domain/statistics"
mkdir -p "$BASE/by_domain/machine_learning"
mkdir -p "$BASE/by_domain/network_science"

mkdir -p "$BASE/by_phase/phase_0"
mkdir -p "$BASE/by_phase/phase_1"
mkdir -p "$BASE/by_phase/phase_3"
mkdir -p "$BASE/by_phase/phase_4"
mkdir -p "$BASE/by_phase/phase_7"
```

### 1.3 Verify structure

```bash
ls -la "$BASE"
# Should show: inbox, staging, active, rejected, archived, by_domain, by_phase
```

---

## Step 2: Create Configuration Files

### 2.1 Create index.json

**Path**: `output/external_resources/index.json`

```json
{
  "version": "3.2.0",
  "last_updated": "",
  "total_resources": 0,
  "by_domain": {},
  "by_type": {},
  "by_consumer": {},
  "by_phase": {},
  "resources": {}
}
```

### 2.2 Create config.json

**Path**: `output/external_resources/config.json`

```json
{
  "version": "3.2.0",
  "created_at": "2026-01-31T00:00:00Z",
  "lifecycle": {
    "max_staging_age_hours": 24,
    "max_active_resources": 50,
    "auto_archive_after_days": 7,
    "auto_delete_rejected_after_days": 30
  },
  "quality": {
    "threshold_approve": 7.0,
    "threshold_conditional": 5.0
  },
  "code_extensions": [".py", ".m", ".cpp", ".c", ".java", ".r", ".jl"],
  "code_weights": {
    "credibility": 0.15,
    "relevance": 0.25,
    "quality": 0.20,
    "actionability": 0.40
  },
  "document_weights": {
    "credibility": 0.25,
    "relevance": 0.30,
    "quality": 0.25,
    "actionability": 0.20
  },
  "limits": {
    "max_content_size_kb": 500
  }
}
```

### 2.3 Create statistics.json

**Path**: `output/external_resources/statistics.json`

```json
{
  "generated_at": "",
  "totals": {
    "active": 0,
    "rejected": 0,
    "archived": 0
  },
  "by_phase": {},
  "by_domain": {},
  "by_type": {},
  "quality_distribution": {
    "excellent_8_10": 0,
    "good_7_8": 0,
    "conditional_5_7": 0
  },
  "most_accessed": []
}
```

### 2.4 Create summary_for_agents.md

**Path**: `output/external_resources/active/summary_for_agents.md`

```markdown
# External Resources Summary for Agents

> **Last Updated**: (none yet)
> **Total Resources**: 0
> **Generated By**: @knowledge_curator

---

## Quick Reference

| Agent | Recommended Resources | Priority |
|-------|----------------------|----------|
| (none yet) | - | - |

---

## By Phase

(No resources available yet)

---

## High-Value Resources (Score >= 8.0)

(None yet)

---

## How to Use

1. **Check relevance**: Find your agent in "Quick Reference"
2. **Read summary**: Go to your phase section
3. **Access resource**: Use the path provided
4. **If helpful**: Use insights in your work
5. **If not helpful**: Ignore and proceed

**Note**: Resources are SUPPLEMENTARY. Internal knowledge (HMML 2.0) takes priority.
```

### 2.5 Create README.md

**Path**: `output/external_resources/README.md`

```markdown
# External Resources

This folder contains external resources provided manually via inbox/.

**GITIGNORED**: This folder is not tracked by git. SHA-256 hashes ensure data integrity.

## Structure
- `inbox/` - Drop files here for processing
- `staging/` - Awaiting quality review
- `active/` - Approved for agent use
  - `summary_for_agents.md` - Context overlay (ALL AGENTS READ THIS)
- `rejected/` - Failed quality check
- `archived/` - No longer active

## Quality Thresholds
- APPROVED: >= 7.0/10 (+ syntax OK for code)
- CONDITIONAL: 5.0-6.9/10 (+ syntax OK for code)
- REJECTED: < 5.0/10 OR syntax FAIL

## Code Scoring
Code files (.py, .m, .cpp) get 40% actionability weight and must pass syntax check.

## Usage
ALL agents read `active/summary_for_agents.md` before starting their tasks.

## Verification
Run: `python docs/newplan/10_tools/indexer.py verify` to check SHA-256 hashes.

## Files
- `index.json` - Master searchable index (with SHA-256 hashes)
- `config.json` - Pipeline configuration
- `statistics.json` - Usage analytics
```

---

## Step 3: Create Agent Files

### 3.1 Copy agent templates

Copy from `docs/newplan/02_agents/` to `.claude/agents/`:

```bash
SRC="D:/mcmkiller/MCM-Killer/docs/newplan/02_agents"
DEST="D:/mcmkiller/MCM-Killer/workspace/2025_C/.claude/agents"

cp "$SRC/resource_ingestor.md" "$DEST/"
cp "$SRC/quality_checker.md" "$DEST/"
cp "$SRC/knowledge_curator.md" "$DEST/"
cp "$SRC/resource_manager.md" "$DEST/"
```

### 3.2 Verify agent files

```bash
ls -la "$DEST" | grep -E "(resource_ingestor|quality_checker|knowledge_curator|resource_manager)"
# Should show all 4 new agent files
```

---

## Step 4: Create Tool Scripts

### 4.1 Create quality check script

**Path**: `docs/newplan/10_tools/quality_check.py`

(See 10_tools/quality_check.py for full implementation with syntax validation and code weights)

### 4.2 Create indexer script

**Path**: `docs/newplan/10_tools/indexer.py`

(See 10_tools/indexer.py for full implementation with SHA-256 hashing and verify commands)

---

## Step 5: Create Protocol 21

**Path**: `workspace/2025_C/.claude/protocols/protocol_21_external_resource_consistency.md`

```markdown
# Protocol 21: External Resource Data Consistency

## Purpose
Prevent data inconsistencies between paper content and cited external resources.

## When Applied
- Phase 7 (Paper Writing)
- Phase 8 (Summary)
- Phase 9 (Polish)
- Phase 9.1 (Mock Judging)

## Checks

### 1. Citation Verification
- Resource ID follows MAN_xxx format
- Entry exists in references section
- Resource file exists in active/ folder

### 2. Data Accuracy
- Compare quoted values with source content.md
- Tolerance: ±5% for numerical values
- Exact match for text/methodology

### 3. Source Availability
- Resource must be in active/ (not rejected/archived)
- Quality score >= 5.0

### 4. SHA-256 Hash Verification
- Run: `python docs/newplan/10_tools/indexer.py verify`
- All file hashes must match stored values
- Hash mismatch = file tampering = AUTO-REJECT

## Verdict Criteria

| Condition | Verdict |
|-----------|---------|
| All verified, data matches, hashes valid | ✅ APPROVED |
| Minor formatting differences | ⚠️ CONDITIONAL |
| Missing citations, mismatch, or hash failure | ❌ REJECTED |

## Auto-Reject Conditions
- Resource ID not found in active/
- Quoted number differs by >5%
- Methodology misattributed
- Rejected resource cited
- **SHA-256 hash mismatch**

## Validation Report Template

```markdown
## External Resource Consistency (Protocol 21)

### Citations Found
| Resource ID | Title | Status | Data Match | Hash |
|-------------|-------|--------|------------|------|
| MAN_001 | ... | ✅ Active | ✅ | ✅ |

### Hash Verification
Run: python docs/newplan/10_tools/indexer.py verify
Result: X/Y files verified OK

### Issues Found
{list issues or "None"}

### Protocol 21 Verdict: ✅ PASSED / ❌ FAILED
```
```

---

## Step 6: Update Existing Agents

### 6.1 Update validator.md

Add to `workspace/2025_C/.claude/agents/validator.md`:

```markdown
## External Resource Validation (Protocol 21)

### Checks
1. Citation completeness (MAN_xxx in references)
2. Data consistency (values match source)
3. Resource availability (in active/)
4. **SHA-256 hash verification**

### Report Addition
Include "External Resource Consistency" section in validation reports.
```

### 6.2 Update time_validator.md

Add Phase 0.1 timing requirements (see 07_validation_updates.md).

---

## Step 7: Update CLAUDE.md

Add new sections as specified in `08_claude_md_updates.md`.

---

## Step 8: Update Protocol Index

Add to `workspace/2025_C/.claude/protocols/README.md`:

```markdown
| 21 | External Resource Data Consistency | Phase 7+ | ✅ |
```

---

## Step 9: Update .gitignore

Add to `workspace/2025_C/.gitignore` or root `.gitignore`:

```
# External resources (manual uploads, gitignored for SHA-256 integrity)
workspace/*/output/external_resources/
```

---

## Step 10: Test Pipeline

### 10.1 Test folder structure

```bash
ls -la output/external_resources/
# Verify all directories and files exist
```

### 10.2 Test config loading

```python
import json
with open("output/external_resources/config.json") as f:
    config = json.load(f)
print(config["quality"]["threshold_approve"])  # Should print 7.0
```

### 10.3 Test index operations

```bash
python docs/newplan/10_tools/indexer.py stats
# Should return current statistics
```

### 10.4 Test hash verification

```bash
python docs/newplan/10_tools/indexer.py verify
# Should return "No resources to verify" or verification results
```

---

## Step 11: Verify Integration

### 11.1 Checklist

- [ ] All 4 agent files in `.claude/agents/`
- [ ] Folder structure at `output/external_resources/`
- [ ] inbox/ folder exists for manual uploads
- [ ] summary_for_agents.md in active/
- [ ] Protocol 21 in `.claude/protocols/`
- [ ] CLAUDE.md updated with new section
- [ ] Validator includes Protocol 21 checks
- [ ] Tool scripts in `docs/newplan/10_tools/`
- [ ] Config files initialized
- [ ] .gitignore updated

### 11.2 Smoke test

1. Manually drop a test file in inbox/
2. Run @resource_ingestor to process
3. Run @quality_checker to validate
4. Verify migration to active/ works
5. Check index update with SHA-256 hash
6. Verify summary_for_agents.md updated

---

## Post-Implementation

After completing all steps:

1. **Commit changes**:
   ```bash
   git add .
   git commit -m "Add external resources pipeline (v3.2.0)"
   ```

2. **Update version in architectures**:
   - Create `architectures/v3-2-0/` if needed
   - Document changes

3. **Test with real workflow**:
   - Run Phase 0 → 0.1 → 0.2 sequence
   - Verify parallel execution works
   - Test context injection (agents reading summary_for_agents.md)
